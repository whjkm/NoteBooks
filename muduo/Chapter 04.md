
## 多线程与IO

“显然是正确”方式：一个文件只能由一个进程中的一个线程来读写。

多线程应该遵循的原则：
- 每个文件描述符只由一个线程操作，从而轻松解决消息收发的顺序性问题，也避免关闭文件描述符的各种`race condition`。
- 一个线程可以操作多个文件描述符，但一个线程不能操作别的线程拥有的文件描述符。

Exception:

- 对于磁盘文件，在必要的时候多个线程可以同时调用`pread(2)/pwrite(2)`来读写同一个文件；
- 对于`UDP`, 由于协议本身保证消息的原子性，在适当的条件下（比如消息之间彼此独立）可以多个线程同时读写同一个`UDP`文件描述符。


## 用RAII包装文件描述符


### 多线程与fork()

`fork()` 一般不能在多线程程序中调用。


