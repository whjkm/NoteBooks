- [Chapter 06](#chapter-06) 
  - [网络库要点](#网络库要点)
  - [TCP网络编程本质论](#tcp网络编程本质论)

# Chapter 06

## 网络库要点

- 线程安全，原生支持多核多线程。
- 不考虑可移植性，不跨平台，只支持Linux，不支持Windows。
- 主要支持x86-64，兼顾IA32。
- 不支持UDP，只支持TCP。
- 不支持IPv6，只支持IPv4。（现在需要支持IPv6？？？）
- 不考虑广域网应用，只考虑局域网。
- 不考虑公网，只考虑内网。不为安全性做特别的增强。
- 只支持一种使用模式：非阻塞IO + one event loop per thread，不支持阻塞IO。
- API简单易用，只暴露具体类和标准库里的类。 API不使用`non-trivial templates`，也不使用虚函数。
- 只满足常用需求的90%，不面面俱到，必要时以app来适应lib。
- 只做library，不做成framework。
- 争取全部代码在5000行以内（不含测试）。

## TCP网络编程本质论

基于事件的非阻塞网络编程是编写高性能并发网络服务程序的主流模式。

**TCP网络编程最本质的是：** 处理三个半事件

1. 连接的建立：服务端接受（accept）新连接和客户端发起(connect)连接。

2. 连接的断开：主动断开（close, shutdown）和被动断开（read(2)返回0）

3. 消息到达，文件描述符可读：如何处理分包，应用层的缓冲如何设计。

4. 消息发送完毕，这算半个：发送完毕是指将数据写入操作系统的缓冲区，将由TCP协议栈负责数据的发送与重传，不代表对方已经收到数据。

  
